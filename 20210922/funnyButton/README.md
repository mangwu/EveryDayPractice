# 公众号看到的一个有关 hook state 闭包的问题

## 简单的添加元素按钮

- 渲染一个按钮（button），点击它能添加一个功能和它一致的按钮
  - 使用外部的变量区分设置 key
  - 点击事件使用同一点击函数
- 点击一开始就存在的按钮若干次后，再后来添加的按钮会发生什么
  - 被点击按钮会消失并且之后的按钮也会消失
  - 添加一个按钮，该按钮的 key 值依赖于外部变量（已添加按钮的个数+1）

## state hook 的闭包

1. 每次渲染时的，React 都会创建 add 函数
2. add 函数被创建时和点击按钮有关
3. 点击一开始就有的按钮，自然创建出了有类似功能的添加按钮
4. 但是区别在于：
   1. 一开始就有的按钮的上下文环境是在变化的
   2. 创建出来的按钮的上下文会形成一个闭包，就是**创建该对应 add 函数时的闭包**
      1. 该闭包中包含 add 函数，list，setList
      2. list 就是还未添加本按钮时的按钮列表
      3. 所以点击按钮后只显示在当时渲染时的 list，然后添加一个按钮

### 错误的使用

- 这个闭包问题其实就是 state hook 的错误使用方式
- 使用函数式更新就可以解决该问题
  - 函数式更新能够提供还没有更新的最新上下文
  - 在setList时使用箭头函数即可
